<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إدارة التصنيع – شركة سرت</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #001a3d;
      --card-bg: rgba(10, 44, 90, 0.55);
      --card-border: rgba(255,255,255,0.12);
      --text: #f0f4ff;
      --text-light: #c3d4ff;
      --accent: #00aeff;
      --shadow: 0 8px 32px rgba(0,0,0,0.4);
      --success: #2ecc71;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Cairo', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 16px 12px;
    }

    /* التنسيقات العامة للوحة */
    header { text-align: center; margin-bottom: 20px; }
    .search-container { max-width: 500px; margin: 0 auto 20px; position: sticky; top: 10px; z-index: 100; }
    #searchInput { 
        width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--accent);
        background: rgba(255,255,255,0.1); color: white; outline: none;
    }

    .tabs { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
    .tab { 
        padding: 8px 16px; border-radius: 20px; background: var(--card-bg); 
        border: 1px solid var(--card-border); cursor: pointer; transition: 0.3s;
    }
    .tab.active { background: var(--accent); color: var(--bg); font-weight: bold; }

    .cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
    .card { 
        background: var(--card-bg); border: 1px solid var(--card-border); 
        border-radius: 15px; padding: 15px; backdrop-filter: blur(10px);
    }
    .card .name { color: var(--accent); font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid var(--card-border); padding-bottom: 5px; }
    .card .row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; }
    .card .row strong { color: var(--text-light); }
    
    .status-ongoing { color: var(--success); font-weight: bold; }
  </style>
</head>
<body>

<header>
    <h2>إدارة التصنيع - منظومة المتابعة</h2>
</header>

<div class="search-container">
    <input type="text" id="searchInput" placeholder="بحث باسم الموظف أو الرقم الوظيفي...">
</div>

<div class="tabs" id="tabsContainer">
    <div class="tab active" onclick="filterTab('الكل', this)">الكل</div>
    <div class="tab" onclick="filterTab('معمل الغاز', this)">معمل الغاز</div>
    <div class="tab" onclick="filterTab('الميثانول', this)">الميثانول</div>
    <div class="tab" onclick="filterTab('المصفاة', this)">المصفاة</div>
</div>

<div class="cards" id="cardsGrid">
    </div>

<script>
    let allData = [];

    // دالة إصلاح التاريخ (تأخذ النص المباشر من CSV)
    function cleanDate(dateStr) {
        if (!dateStr || dateStr.trim() === "" || dateStr === "null") return "";
        // إذا كان التاريخ يحتوي على حرف T (صيغة ISO)، نأخذ الجزء الأول فقط
        return dateStr.split('T')[0];
    }

    // دالة معالجة حقل "إلى" مع شرط "مستمر"
    function getToStatus(since, to) {
        let cleanTo = cleanDate(to);
        let cleanSince = cleanDate(since);
        
        if (cleanTo) return cleanTo;
        if (cleanSince && !cleanTo) return '<span class="status-ongoing">مستمر</span>';
        return "";
    }

    // محاكاة جلب البيانات من CSV (استخدم Fetch في النسخة الحقيقية)
    const csvContent = `EmployeeID,Name,Depatment,Code,Since,To,TravelDate,Duration,Remarks,SecondeeDdepartment,Retirementdate
12220,مروان محمد حسن,معمل الغاز,,2025-05-04,2025-12-05,,,اجازة بدون مرتب (في انتظار صدور القرار),,
12610,عبدالرحمن فتحى الصادق ,معمل الغاز,A,2025-11-04,,,,اجازة بدون مرتب (في انتظار صدور القرار),,
11324,عبدالفتاح عبدالرحمن السنوسى,معمل الغاز,منتدب,2025-04-15,2026-04-14,,,,إدارة الإنتاج,
12217,احمد فرج السنوسى الأوجلى,معمل الغاز,K,,,2025-08-31T22:00:00Z,26أسبوع,,,
22713,عبدالحميد صالح سعد,المصفاة,منقول,2026-01-01,,,,,,
05363, عياد محمد رحومه ,المصفاة,متقاعد,,,,,,,2026-01-10`;

    // تحويل الـ CSV إلى مصفوفة كائنات
    function parseCSV(data) {
        const lines = data.trim().split('\n');
        const headers = lines[0].split(',');
        return lines.slice(1).map(line => {
            const values = line.split(',');
            let obj = {};
            headers.forEach((header, i) => {
                obj[header.trim()] = values[i] ? values[i].trim() : "";
            });
            return obj;
        });
    }

    function renderCards(data) {
        const grid = document.getElementById('cardsGrid');
        grid.innerHTML = data.map(row => `
            <div class="card">
                <div class="name">${row.Name}</div>
                <div class="row"><strong>الرقم الوظيفي:</strong> <span>${row.EmployeeID}</span></div>
                <div class="row"><strong>الإدارة:</strong> <span>${row.Depatment}</span></div>
                <div class="row"><strong>منذ:</strong> <span>${cleanDate(row.Since)}</span></div>
                <div class="row"><strong>إلى:</strong> <span>${getToStatus(row.Since, row.To)}</span></div>
                ${row.TravelDate ? `<div class="row"><strong>تاريخ السفر:</strong> <span>${cleanDate(row.TravelDate)}</span></div>` : ''}
                ${row.Retirementdate ? `<div class="row"><strong>تاريخ التقاعد:</strong> <span>${cleanDate(row.Retirementdate)}</span></div>` : ''}
                <div class="row"><strong>ملاحظات:</strong> <span>${row.Remarks || row.Code || '-'}</span></div>
            </div>
        `).join('');
    }

    // وظائف البحث والفلترة
    function filterTab(dep, element) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        element.classList.add('active');
        const filtered = dep === 'الكل' ? allData : allData.filter(d => d.Depatment === dep);
        renderCards(filtered);
    }

    document.getElementById('searchInput').addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        const filtered = allData.filter(d => 
            d.Name.toLowerCase().includes(val) || d.EmployeeID.includes(val)
        );
        renderCards(filtered);
    });

    // البدء
    allData = parseCSV(csvContent);
    renderCards(allData);

</script>
</body>
</html>